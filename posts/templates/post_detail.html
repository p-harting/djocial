{% extends "base.html" %}

{% block content %}
<h1>{{ post.title }}</h1>
<p><strong>Author:</strong> {{ post.author }} | <strong>Date:</strong> {{ post.created_on|date:"d M Y H:i" }}</p>

<div>{{ post.content|linebreaks }}</div>

<!-- Like button -->
<form action="{% url 'like_post' post.slug %}" method="POST">
  {% csrf_token %}
  <button type="submit" class="btn btn-primary">
    {% if user in post.likes.all %}
    Unlike
    {% else %}
    Like
    {% endif %}
  </button>
</form>
<p>{{ post.number_of_likes }} Likes</p>

<hr>

<!-- Comments Section -->
<h2>Comments</h2>
<div>
  {% for comment in post.comments.all %}
    <div class="comment">
      <p><strong>{{ comment.author }}</strong> - {{ comment.created_on|date:"d M Y H:i" }}</p>
      <p>{{ comment.body|linebreaks }}</p>
    </div>
  {% empty %}
    <p>No comments yet. Be the first to comment!</p>
  {% endfor %}
</div>

<!-- Comment Form -->
{% if user.is_authenticated %}
  <h3>Leave a Comment</h3>
  <form action="" method="post">
    {% csrf_token %}
    <textarea name="comment_body" rows="4" class="form-control" placeholder="Write your comment here..."></textarea>
    <button type="submit" class="btn btn-primary mt-2">Submit</button>
  </form>
{% else %}
  <p>You must be <a href="{% url 'login' %}">logged in</a> to comment.</p>
{% endif %}

{% endblock %}
